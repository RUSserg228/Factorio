# Factorio GPT Companion Utility

Эта утилита запускается хостом сервера Factorio и обеспечивает связь между модом и
API OpenAI (или совместимым). Она хранит ключ, следит за лимитами сообщений и выдаёт
статус, который отображается внутри игры.

## Возможности

* Мастер первой настройки с согласием на обработку данных и вводом API ключа.
* Проверка валидности ключа (`GET /v1/models`).
* Локальное хранение конфигурации (`~/.factorio-gpt/config.json`).
* HTTP API для мода:
  * `GET /status` — готовность сервиса, профили моделей, текущие лимиты.
  * `POST /chat` — проксирование запроса `chat.completions` в OpenAI.
  * `POST /config` — обновление настроек по запросу мода.
* Учёт лимитов (`x-ratelimit-*`) для отображения оставшихся сообщений в интерфейсе мода.

## Установка

1. Установите Python 3.10 или новее.
2. Установите зависимости:
   ```bash
   pip install requests
   ```
3. Склонируйте репозиторий и выполните первичную настройку:
   ```bash
   python utility/gpt_assistant_service.py --setup
   ```
4. После успешной проверки запустите сервис:
   ```bash
   python utility/gpt_assistant_service.py
   ```

## Параметры запуска

* `--setup` — мастер первой настройки.
* `--status` — вывод текущих настроек и профилей.
* `--reset` — удаление конфигурации и повторный запуск мастера.
* `--host` / `--port` — переопределение адреса и порта сервиса.

## Интеграция с модом

* Мод читает `GET /status`, чтобы убедиться в готовности сервиса и показать остаток
  сообщений: «осталось X до HH:MM».
* При отправке запроса мод вызывает `POST /chat` с полями `messages`, `model`,
  `temperature` и данными выделенной области.
* Ответ `POST /chat` содержит поле `rate_limit`, которое мод отображает в UI.
* Локальные чаты и снапшоты областей хранятся у хоста; клиенты получают только
  актуальный ответ для отображения.

## Публикация

При подготовке публичной сборки утилиту можно упаковать в исполняемый файл (например,
через PyInstaller) и приложить к инструкции по установке мода. Убедитесь, что
использование API OpenAI соответствует условиям сервиса и что вы не распространяете
ключ вместе с модом.
